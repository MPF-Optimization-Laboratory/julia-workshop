<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/julia-workshop/libs/katex/katex.min.css"> <link rel=stylesheet  href="/julia-workshop/libs/highlight/styles/github.min.css"> <link rel=stylesheet  href="/julia-workshop/css/franklin.css"> <link rel=stylesheet  href="/julia-workshop/css/basic.css"> <link rel=icon  href="/julia-workshop/assets/favicon.png"> <title>Problem 1 </title> <header> <div class=blog-name ><a href="/julia-workshop/">Julia Workshop</a></div> <nav> <ul> <li><a href="/julia-workshop/">Home</a> </ul> </nav> </header> <div class=franklin-content ><h2 id=problem_1 ><a href="#problem_1" class=header-anchor >Problem 1 </a></h2> <p>Check whether your solutions for last week&#39;s problems were type stable. Which function cannot be type stable?</p> <h2 id=problem_2 ><a href="#problem_2" class=header-anchor >Problem 2</a></h2> <p>For the Peano numbers problem from last time, in the following code, how many compilations for <code>&#43;</code> happen?</p> <pre><code class="julia hljs">Zero() + Zero()
Zero() + convert(PeanoNumber, <span class=hljs-number >1</span>)
convert(PeanoNumber, <span class=hljs-number >1</span>) + Zero()
convert(PeanoNumber, <span class=hljs-number >1</span>) + convert(PeanoNumber, <span class=hljs-number >5</span>)
convert(PeanoNumber, <span class=hljs-number >2</span>) + convert(PeanoNumber, <span class=hljs-number >5</span>)</code></pre> <h2 id=problem_3 ><a href="#problem_3" class=header-anchor >Problem 3</a></h2> <p>Write code which &quot;draws&quot; Julia sets for at least the complex numbers and the quaternions for quadratic polynomials.</p> <h3 id=part_1 ><a href="#part_1" class=header-anchor >Part 1</a></h3> <p>The typical method for drawing Julia sets with complex numbers is:</p> <ol> <li><p>Let <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy=false >(</mo><mi>z</mi><mo stretchy=false >)</mo><mo>=</mo><msup><mi>z</mi><mn>2</mn></msup><mo>+</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">f(z) = z^2 + c</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8974em;vertical-align:-0.0833em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span> for some <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span>.</p> <li><p>Set every pixel to the integer zero.</p> <li><p>For every pixel in an image,</p> <li><p>Compute a complex number <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span> to start with.</p> <ul> <li><p>This is usually a simple map, like picking the <code>x</code> coordinate for the real component and <code>y</code> for complex. You probably want to translate so that zero is in the middle of the image, and scale the coordinates up or down so that you get all the interesting stuff in &quot;frame&quot;.</p> </ul> <li><p>Let <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">i = 0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6595em;"></span><span class="mord mathnormal">i</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >0</span></span></span></span></p> <li><p>While <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>&lt;</mo><mi>I</mi><mi>T</mi><mi>E</mi><mi>R</mi><mi>A</mi><mi>T</mi><mi>I</mi><mi>O</mi><mi>N</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">i &lt; ITERATIONS</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6986em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">i</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >&lt;</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.00773em;">TER</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.05764em;">ONS</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>b</mi><mi>s</mi><mo stretchy=false >(</mo><mi>z</mi><mo stretchy=false >)</mo><mo>&lt;</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">abs(z) &lt; R</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ab</span><span class="mord mathnormal">s</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >&lt;</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span>:</p> <ol> <li><p>Let <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mo>=</mo><mi>f</mi><mo stretchy=false >(</mo><mi>z</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">z = f(z)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=mclose >)</span></span></span></span></p> <li><p>Let <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mi>i</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i = i + 1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6595em;"></span><span class="mord mathnormal">i</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.7429em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">i</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >1</span></span></span></span></p> </ol> <li><p>Set the value of the pixel to a color which is a function of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span></p> <ul> <li><p>You could just map <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >[</mo><mn>0</mn><mo separator=true >,</mo><mi>I</mi><mi>T</mi><mi>E</mi><mi>R</mi><mi>A</mi><mi>T</mi><mi>I</mi><mi>O</mi><mi>N</mi><mi>S</mi><mo stretchy=false >]</mo><mo>↦</mo><mo stretchy=false >(</mo><mn>0</mn><mo separator=true >,</mo><mn>1</mn><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">[0, ITERATIONS] \mapsto (0, 1)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >[</span><span class=mord >0</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.00773em;">TER</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.05764em;">ONS</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >↦</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class=mord >0</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord >1</span><span class=mclose >)</span></span></span></span> and use a grayscale image</p> </ul> </ol> <p>You should write a type to represent the polynomials you want to try. You should start with one for the form <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>z</mi><mn>2</mn></msup><mo>+</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">z^2 + c</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8974em;vertical-align:-0.0833em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span>, where you should only store the complex number <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span>. You can define function calls for your polynomial like so:</p> <pre><code class="julia hljs"><span class=hljs-keyword >struct</span> Poly{...} &lt;: AbstractPolynomial
    ...
<span class=hljs-keyword >end</span>

<span class=hljs-keyword >function</span> (Poly{...})(z)
     <span class=hljs-comment ># calculate here</span>
<span class=hljs-keyword >end</span>

<span class=hljs-comment ># now you can do this:</span>

p = Poly(...)
z = some_complex_number()
p(z)  <span class=hljs-comment ># calls the function above</span></code></pre> <p>Now, test your function&#33; You don&#39;t actually have to draw to an image, but <a href="https://juliaimages.org/stable/">Images.jl</a> will help you out here if you do. To use a simple grayscale colormap:</p> <pre><code class="julia hljs">juliadrawing = <span class=hljs-built_in >Matrix</span>{<span class=hljs-built_in >Int</span>}(...)
<span class=hljs-comment ># call your function for drawing the Julia set here</span>
<span class=hljs-keyword >using</span> Images
img = Gray.(juliadrawing ./ maximum(juliadrawing)) <span class=hljs-comment ># scale to (0, 1) and convert to a grayscale image</span>
<span class=hljs-comment ># below is only necessary if you&#x27;re not using a Jupyter or Pluto notebook</span>
<span class=hljs-keyword >using</span> ImageView
imshow(img)</code></pre> <p>Tips:</p> <ul> <li><p>You can create a matrix of all zeros of size <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><mi>m</mi><mo separator=true >,</mo><mi>n</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">(m, n)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal">m</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class=mclose >)</span></span></span></span> using <code>zeros&#40;Int, m, n&#41;</code></p> <li><p>Try other polynomials with only even powers of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span></p> </ul> <h3 id=part_2 ><a href="#part_2" class=header-anchor >Part 2</a></h3> <p>Now, modify your function and polynomial types to be able to use either complex numbers or the <a href="https://en.wikipedia.org/wiki/Quaternion">quaternions</a>. You can use <a href="https://github.com/JuliaGeometry/Quaternions.jl">Quaternions.jl</a> for all the arithmetic needs. Note <code>Complex&#123;T&#125;</code> and <code>Quaternion&#123;T&#125;</code> are both subtypes of <code>Number</code>. You could also accept reals if you want to, but they won&#39;t do much interesting.</p> <p>Your &quot;image&quot; now is going to need to be four dimensional, since quaternions have four components. You can&#39;t draw that, but you can pretty easily take 2D slices of it to look at. If we label the four orders <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator=true >,</mo><mi>b</mi><mo separator=true >,</mo><mi>c</mi><mo separator=true >,</mo><mi>d</mi></mrow><annotation encoding="application/x-tex">a, b, c, d</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">a</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class="mord mathnormal">c</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class="mord mathnormal">d</span></span></span></span>, then:</p> <pre><code class="julia hljs">img = <span class=hljs-built_in >Array</span>{<span class=hljs-built_in >Int</span>, <span class=hljs-number >4</span>}(...)  <span class=hljs-comment ># fourth order tensor</span>

<span class=hljs-comment ># this is the plane $c = 5, d = 4$</span>
img[:, :, <span class=hljs-number >5</span>, <span class=hljs-number >4</span>]

<span class=hljs-comment ># this is the plane $a = 1, c = 3$</span>
img[<span class=hljs-number >1</span>, :, <span class=hljs-number >3</span>, :]</code></pre> <p>If you want to take other slices not along those axes, the easiest thing to do is probably change your map from pixels to starting quaternions.</p> <p>Tips:</p> <ul> <li><p>Use dispatch to pick what function gets your starting quaternions</p> <li><p>If you&#39;re feeling fancy, ImageView.jl does have tools for viewing 3D images, so you could slice once fewer and have a slider for the third dimension</p> </ul> <h3 id=part_3 ><a href="#part_3" class=header-anchor >Part 3</a></h3> <p>First, use <code>@code_warntype</code> to make sure your code is type-stable. In particular, make sure you test stuff like making <code>c</code> a <code>Quaternion&#123;Int&#125;</code> instead of using floats. Try to get the widest array of input types and check that you&#39;re type stable for all of them. Make sure you&#39;re properly testing any helper functions you&#39;ve written as well.</p> <p>Next, use BenchmarkTools.jl to compare performance between quaternions and complex numbers. Make sure you&#39;re testing the same number of pixels &#40;for example, if you&#39;re doing a <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>256</mn><mo>×</mo><mn>256</mn></mrow><annotation encoding="application/x-tex">256 × 256</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.7278em;vertical-align:-0.0833em;"></span><span class=mord >256</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >×</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >256</span></span></span></span> image for complex numbers, do a <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>16</mn><mo>×</mo><mn>16</mn><mo>×</mo><mn>16</mn><mo>×</mo><mn>16</mn></mrow><annotation encoding="application/x-tex">16 × 16 × 16 × 16</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.7278em;vertical-align:-0.0833em;"></span><span class=mord >16</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >×</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.7278em;vertical-align:-0.0833em;"></span><span class=mord >16</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >×</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.7278em;vertical-align:-0.0833em;"></span><span class=mord >16</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >×</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >16</span></span></span></span> iage for quaternions&#41;. Garbage collection should take up very little to none of the time here.</p> <p>Finally, use FlameGraphs.jl and one of its visualization packages to see where your program spends most of its time. Make sure there&#39;s no orange &#40;garbage collection&#41; or red &#40;runtime dispatch&#41; happening. See if you can use the information to speed up your program at all, and confirm using BenchmarkTools.</p> <div class=page-foot > <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> Mia Kramer. Last modified: September 15, 2024. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> <script src="/julia-workshop/libs/highlight/highlight.min.js"></script> <script>hljs.highlightAll();hljs.configure({tabReplace: ' '});</script>